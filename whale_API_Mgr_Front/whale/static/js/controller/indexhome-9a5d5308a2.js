whaleModule.controller("indexhomeController",["$scope","$rootScope","$window","$http","$interval","$location","$timeout","$state","$q",function(e,a,o,t,r,n,l,s,i){function c(e){var a=document.getElementById("gradient"),o=a.getContext("2d");o.clearRect(0,0,a.width,a.height);var t=o.createLinearGradient(0,0,0,e);t.addColorStop(0,"red"),t.addColorStop(1,"transparent"),o.fillStyle=t,o.fillRect(0,0,a.width,e);var r=o.createLinearGradient(0,0,e,0);r.addColorStop(0,"red"),r.addColorStop(1,"transparent"),o.fillStyle=r,o.fillRect(0,0,e,a.height);var n=o.createLinearGradient(a.width-e,0,a.width,0);n.addColorStop(1,"red"),n.addColorStop(0,"transparent"),o.fillStyle=n,o.fillRect(a.width-e,0,e,a.height);var l=o.createLinearGradient(0,a.height-e,0,a.height);l.addColorStop(1,"red"),l.addColorStop(0,"transparent"),o.fillStyle=l,o.fillRect(0,a.height-e,a.width,e)}function d(){e.canvas=!1}function u(){h=window.setInterval(function(){w?N+=2:N-=2,N>=40&&(w=!1),N<=20&&(w=!0),c(N)},100)}e.$on("$locationChangeStart",function(){window.clearInterval(h),e.canvas=!1}),e.$on("$locationChangeSuccess",function(){window.clearInterval(h),e.canvas=!1}),e.$on("$stateChangeStart",function(){window.clearInterval(h),r.cancel(e.timer1),e.canvas=!1}),e.$on("$stateChangeSuccess",function(){window.clearInterval(h),e.canvas=!1}),e.picload=!0,t.get("/whale_alarm/monitor/allNodes").success(function(a){if(10200==a.code){if(e.$broadcast("loading.request","home1 home"),null==a.allServiceNodes||0==a.allServiceNodes.length)return;e.allServiceNodes=[];angular.forEach(a.allServiceNodes,function(o,t,r){for(var n in o)e.allServiceNodes[t]={},e.allServiceNodes[t].name=n,e.allServiceNodes[t].running=o[n].running,e.allServiceNodes[t].total=o[n].total,0==o[n].running&&(window.clearInterval(h),e.canvas=!0,u());a.allServiceNodes.length})}}),t.get("/whale_alarm/monitor/crawlNodes").success(function(a){if(10200==a.code){var o="home2 home";if(e.$broadcast("loading.request",o),null==a.crawlNodes||0==a.crawlNodes.length)return;e.crawlNodes=[];for(var t in a.crawlNodes[0]){e.crawlNodes1={},e.crawlNodes1.name=t,e.crawlNodes1.shuzu=[];var r=0;for(var o in a.crawlNodes[0][t])e.crawlNodes1.shuzu[r]={},e.crawlNodes1.shuzu[r].name1=o,e.crawlNodes1.shuzu[r].running=a.crawlNodes[0][t][o].running,e.crawlNodes1.shuzu[r].total=a.crawlNodes[0][t][o].total,e.crawlNodes1.shuzu[r].status=a.crawlNodes[0][t][o].status,e.crawlNodes1.shuzu[r].endTime=a.crawlNodes[0][t][o].endTime,e.crawlNodes1.shuzu[r].startTime=a.crawlNodes[0][t][o].startTime,e.crawlNodes1.shuzu[r].taskName=a.crawlNodes[0][t][o].taskName,e.crawlNodes1.shuzu[r].totalCount=a.crawlNodes[0][t][o].totalCount,0==a.crawlNodes[0][t][o].running&&(window.clearInterval(h),e.canvas=!0,u()),r++;e.crawlNodes.push(e.crawlNodes1)}}}),t.get("/whale_alarm/monitor/apiNodes").success(function(a){if(10200==a.code){if(e.$broadcast("loading.request","home3 home"),null==a.ApiNodes||0==a.ApiNodes.length)return;e.ApiNodes=[],angular.forEach(a.ApiNodes,function(a,o,t){for(var r in a)e.ApiNodes[o]={},e.ApiNodes[o].name=r,e.ApiNodes[o].running=a[r].running,e.ApiNodes[o].total=a[r].total,0==a[r].total?e.ApiNodes[o].compare=0:e.ApiNodes[o].compare=a[r].running/a[r].total,0==a[r].running&&(window.clearInterval(h),e.canvas=!0,u())});e.ApiNodes.sort(function(e){return function(a,o){var t=a[e],r=o[e];return isNaN(Number(t))||isNaN(Number(r))||(t=Number(t),r=Number(r)),t<r?-1:t>r?1:0}}("compare"))}}),t.get("/whale_alarm/tokenMap/query").success(function(a){if(10200==a.code){e.APIdetail=a.data,e.$broadcast("loading.request","home5 home")}}),t.get("/whale_alarm/proxy/getIpStatusByType").success(function(a){10200==a.code&&(e.total_ip=a.data.total_ip,e.free_ip=a.data.free_ip,function(a){var o=a,t=0,r=o,n=setInterval(function(){t+=.3*(r-t),e.total_ip=parseInt(t),Math.abs(r-t)<1&&(e.total_ip=o,clearInterval(n)),e.$apply()},50)}(a.data.total_ip),function(a){var o=a,t=0,r=o,n=setInterval(function(){t+=.3*(r-t),e.free_ip=parseInt(t),Math.abs(r-t)<1&&(e.free_ip=o,clearInterval(n)),e.$apply()},50)}(a.data.free_ip))}),e.API=function(e){whale.store("apiName",e)},e.canvas=!0;var N=30,w=!0,h=window.setInterval(function(){w?N+=2:N-=2,N>=35&&(w=!1),N<=25&&(w=!0),c(N)},100);e.stopGradient=d,e.timer1=r(function(){e.picload=!0,window.clearInterval(h),e.canvas=!1,t.get("/whale_alarm/monitor/allNodes").success(function(a){if(10200==a.code){if(e.$broadcast("loading.request","home1 home"),null==a.allServiceNodes||0==a.allServiceNodes.length)return;e.allServiceNodes=[];angular.forEach(a.allServiceNodes,function(o,t,r){for(var n in o)e.allServiceNodes[t]={},e.allServiceNodes[t].name=n,e.allServiceNodes[t].running=o[n].running,e.allServiceNodes[t].total=o[n].total,0==o[n].running&&(window.clearInterval(h),e.canvas=!0,u());a.allServiceNodes.length})}}),t.get("/whale_alarm/monitor/crawlNodes").success(function(a){if(10200==a.code){var o="home2 home";if(e.$broadcast("loading.request",o),null==a.crawlNodes||0==a.crawlNodes.length)return;e.crawlNodes=[];for(var t in a.crawlNodes[0]){e.crawlNodes1={},e.crawlNodes1.name=t,e.crawlNodes1.shuzu=[];var r=0;for(var o in a.crawlNodes[0][t])e.crawlNodes1.shuzu[r]={},e.crawlNodes1.shuzu[r].name1=o,e.crawlNodes1.shuzu[r].running=a.crawlNodes[0][t][o].running,e.crawlNodes1.shuzu[r].total=a.crawlNodes[0][t][o].total,e.crawlNodes1.shuzu[r].status=a.crawlNodes[0][t][o].status,e.crawlNodes1.shuzu[r].endTime=a.crawlNodes[0][t][o].endTime,e.crawlNodes1.shuzu[r].startTime=a.crawlNodes[0][t][o].startTime,e.crawlNodes1.shuzu[r].taskName=a.crawlNodes[0][t][o].taskName,e.crawlNodes1.shuzu[r].totalCount=a.crawlNodes[0][t][o].totalCount,0==a.crawlNodes[0][t][o].running&&(window.clearInterval(h),e.canvas=!0,u()),r++;e.crawlNodes.push(e.crawlNodes1)}}}),t.get("/whale_alarm/monitor/apiNodes").success(function(a){if(10200==a.code){if(e.$broadcast("loading.request","home3 home"),null==a.ApiNodes||0==a.ApiNodes.length)return;e.ApiNodes=[],angular.forEach(a.ApiNodes,function(a,o,t){for(var r in a)e.ApiNodes[o]={},e.ApiNodes[o].name=r,e.ApiNodes[o].running=a[r].running,e.ApiNodes[o].total=a[r].total,0==a[r].running&&(window.clearInterval(h),e.canvas=!0,u())})}}),t.get("/whale_alarm/tokenMap/query").success(function(a){if(10200==a.code){e.APIdetail=a.data,e.$broadcast("loading.request","home5 home")}}),t.get("/whale_alarm/proxy/getIpStatusByType").success(function(a){10200==a.code&&(e.total_ip=a.data.total_ip,e.free_ip=a.data.free_ip,function(a){var o=a,t=0,r=o,n=setInterval(function(){t+=.3*(r-t),e.total_ip=parseInt(t),Math.abs(r-t)<1&&(e.total_ip=o,clearInterval(n)),e.$apply()},50)}(a.data.total_ip),function(a){var o=a,t=0,r=o,n=setInterval(function(){t+=.3*(r-t),e.free_ip=parseInt(t),Math.abs(r-t)<1&&(e.free_ip=o,clearInterval(n)),e.$apply()},50)}(a.data.free_ip))})},3e4)}]);