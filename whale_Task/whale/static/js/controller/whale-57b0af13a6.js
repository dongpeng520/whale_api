whaleModule.controller("whaleController",["$scope","$rootScope","$window","$http","$interval","$location","$timeout","$state",function(e,r,o,n,t,a,l,d){e.$on("$stateChangeStart",function(r,o,n,t,a){"whale.index"!=o.name&&(whale.store("TaskToken")||(e.data={account:"",phone:"",YZM:""},e.errorFlag=!1,whale.removestore("sendtime1"),r.preventDefault(),d.go("whale.index"),$("#myModalToken").modal("show")))}),e.$on("$stateChangeSuccess",function(r,o,n,t,a){"whale.index"!=o.name&&(whale.store("TaskToken")||(e.data={account:"",phone:"",YZM:""},e.errorFlag=!1,whale.removestore("sendtime1"),r.preventDefault(),d.go("whale.index"),$("#myModalToken").modal("show")))}),e.data={account:"",phone:"",YZM:""},e.sendYZM=function(){return!whale.store("sendtime1")&&(e.data.phone&&e.data.phone.length>0?whale.phone_bat.test(e.data.phone)?(e.errorFlag=!1,void n.post("/account/usercontroller/selectphone",{phone:e.data.phone,usertype:2}).success(function(r){if(10200!=r.code)return e.errorWen=r.note,void(e.errorFlag=!0);var o=$("#YZM2"),t={params:{Phone:e.data.phone}};n.get("/account/applycontroller/sendMsgCode",t).success(function(r){function n(){t>0?(t--,o.html(t+"s")):(o.html("重新发送"),clearInterval(a),whale.removestore("sendtime1"))}if(10200===r.code){whale.store("sendtime1","no"),e.errorWen="发送成功，请注意查收",e.errorFlag=!0;var t=60,a=setInterval(n,1e3)}else 10010===r.code?(e.errorWen="发送验证码失败",e.errorFlag=!0):10009===r.code?(e.errorWen=r.note,e.errorFlag=!0):(e.errorWen="网络错误，请稍后重试",e.errorFlag=!0)}).error(function(){e.errorWen="网络错误，请稍后重试",e.errorFlag=!0})}).error(function(r){if(400500==r.code)return e.errorWen="请使用管理员账户",void(e.errorFlag=!0)})):(e.errorWen="你输入的手机号码格式不正确，请重新输入",void(e.errorFlag=!0)):(e.errorWen="请输入手机号码",void(e.errorFlag=!0)))},e.submitToken=function(){if(!(e.data.phone&&e.data.phone.length>0))return e.errorWen="请输入手机号码",void(e.errorFlag=!0);if(!whale.phone_bat.test(e.data.phone))return e.errorWen="你输入的手机号码格式不正确，请重新输入",void(e.errorFlag=!0);if(e.errorFlag=!1,!(e.data.YZM&&e.data.YZM.length>0))return e.errorWen="请输入验证码",void(e.errorFlag=!0);if(!/^([0-9]{6}$)/.test(e.data.YZM))return e.errorWen="你输入的验证码格式不正确，请重新输入",void(e.errorFlag=!0);e.errorFlag=!1;var o={params:{phone:e.data.phone,code:e.data.YZM}};n.get("/whaleApiMgr/taskReward/codetest",o).success(function(o){if(10200!=o.code)return e.errorWen=o.note,void(e.errorFlag=!0);n.post("/account/usercontroller/selectphone",{phone:e.data.phone,usertype:2}).success(function(o){return 10200==o.code?(r.errormsg="登陆成功",whale.store("TaskToken",e.data.phone),$("#myModalToken").modal("hide"),void l(function(){r.errormsg=null},1500)):(e.errorWen=o.note,void(e.errorFlag=!0))}).error(function(r){if(400500==r.code)return e.errorWen="请使用管理员账户",void(e.errorFlag=!0)})})}}]);